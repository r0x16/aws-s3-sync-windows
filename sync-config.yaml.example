# Configuración de Sincronización AWS S3 - Guía Completa y Ejemplos
# Este archivo muestra la configuración completa del sistema con ejemplos de todas las estrategias

# ========================================
# CONFIGURACIÓN GLOBAL
# ========================================
global:
  # Retención de logs en meses (los logs más antiguos se eliminan automáticamente)
  log_retention_months: 12

  # Carpeta base para logs (relativa al script)
  log_directory: "log"

  # Archivo de estado (relativo al script) - registra información de la última ejecución
  state_file: "state.json"

# ========================================
# CONFIGURACIONES DE SINCRONIZACIÓN
# ========================================
# Las configuraciones se ejecutarán en el orden definido aquí
# Puedes tener múltiples configuraciones para diferentes propósitos

sync_configurations:

# ========================================
# ESTRATEGIA 1: DateFolder (Predeterminada)
# ========================================
# Sincroniza carpeta específica del día con formato de fecha configurable
# Ideal para: Documentos diarios, backups por fecha, archivos organizados por día
- name: "Documentos Diarios"
  description: "Sincronización de carpeta del día anterior"
  enabled: true
  local_base_path: "C:\\Datos\\Documentos"
  
  # Estrategia: Carpetas por fecha
  sync_strategy:
    type: "DateFolder"
    date_folder_format: "yyyy-MM-dd"  # Formato: 2025-01-15
  
  # Configuración del destino AWS S3
  destination_config:
    bucket_name: "documentos-backup"
    aws_profile: "default"  # Profile AWS a usar ("default" o nombre específico)
    aws_region: "us-east-1"  # Región AWS (opcional, se detecta automáticamente)
    s3_path_structure: "{year}/{month}/{day}"  # Estructura en S3: 2025/01/15
  
  # Opciones adicionales de AWS CLI
  sync_options:
    - "--delete"          # Eliminar archivos en S3 que no existen localmente
    - "--exclude=*.tmp"   # Excluir archivos temporales
    - "--exclude=*.log"   # Excluir archivos de log

# ========================================
# ESTRATEGIA 2: FullDirectory
# ========================================
# Sincroniza toda la carpeta base completa sin importar la estructura
# Ideal para: Backups completos, carpetas de fotos/videos, archivos estáticos
- name: "Backup Completo Fotos"
  description: "Sincronización completa de carpeta de fotos"
  enabled: false  # Deshabilitado por defecto - habilitar según necesidad
  local_base_path: "D:\\Fotos"
  
  # Estrategia: Directorio completo
  sync_strategy:
    type: "FullDirectory"
  
  # Configuración del destino AWS S3
  destination_config:
    bucket_name: "fotos-backup-completo"
    aws_profile: "personal"
    aws_region: "us-west-2"
    s3_path_structure: "full-backup/{year}/{month}"  # Organizar por fecha de ejecución
  
  sync_options:
    - "--exclude=*.DS_Store"  # Excluir archivos del sistema macOS
    - "--exclude=Thumbs.db"   # Excluir archivos del sistema Windows
    - "--storage-class=STANDARD_IA"  # Clase de almacenamiento de acceso infrecuente

# ========================================
# ESTRATEGIA 3: DateRange
# ========================================
# Sincroniza archivos de un rango de fechas hacia atrás
# Ideal para: Logs de aplicaciones, archivos con fechas variables, limpieza automática
- name: "Logs Última Semana"
  description: "Sincronización de logs de últimos 7 días"
  enabled: true
  local_base_path: "C:\\Logs\\Sistema"
  
  # Estrategia: Rango de fechas
  sync_strategy:
    type: "DateRange"
    date_range_days_back: 7  # Últimos 7 días
  
  # Configuración del destino AWS S3
  destination_config:
    bucket_name: "logs-backup"
    aws_profile: "empresa"
    aws_region: "eu-west-1"
    s3_path_structure: "date-range/{year}/{month}"
  
  sync_options:
    - "--exclude=*.lock"   # Excluir archivos de bloqueo
    - "--include=*.log"    # Incluir solo archivos de log
    - "--exclude=*"        # Excluir todo lo demás

# ========================================
# ESTRATEGIA 4: CustomPattern
# ========================================
# Sincroniza usando un patrón personalizado de carpetas con placeholders
# Ideal para: Estructuras complejas, reportes, datos organizados por proyectos
- name: "Reportes Mensuales"
  description: "Sincronización con patrón personalizado"
  enabled: true
  local_base_path: "E:\\Reportes"
  
  # Estrategia: Patrón personalizado
  sync_strategy:
    type: "CustomPattern"
    custom_local_pattern: "{base_path}\\{year}\\{month}"  # E:\Reportes\2025\01
  
  # Configuración del destino AWS S3
  destination_config:
    bucket_name: "reportes-backup"
    aws_profile: "default"
    aws_region: "us-east-1"
    s3_path_structure: "reportes/{year}/{month}"
  
  sync_options:
    - "--exclude=*.draft"  # Excluir borradores
    - "--include=*.pdf"    # Incluir PDFs
    - "--include=*.xlsx"   # Incluir Excel
    - "--exclude=*"        # Excluir todo lo demás

# ========================================
# EJEMPLOS AVANZADOS
# ========================================

# Backup de base de datos con formato personalizado
- name: "DB Backup Diario"
  description: "Backup diario de base de datos"
  enabled: false
  local_base_path: "C:\\Database\\Backups"
  
  sync_strategy:
    type: "DateFolder"
    date_folder_format: "yyyyMMdd"  # Formato sin guiones: 20250115
  
  destination_config:
    bucket_name: "database-backups"
    aws_profile: "production"
    aws_region: "us-east-1"
    s3_path_structure: "db-backups/{year}/{month}/{day}"
  
  sync_options:
    - "--storage-class=STANDARD_IA"  # Almacenamiento de acceso infrecuente
    - "--include=*.bak"              # Solo archivos de backup
    - "--include=*.sql"              # Solo archivos SQL
    - "--exclude=*"                  # Excluir todo lo demás

# Configuración del sistema completa
- name: "Config Sistema"
  description: "Backup de archivos de configuración"
  enabled: false
  local_base_path: "C:\\Config"
  
  sync_strategy:
    type: "FullDirectory"
  
  destination_config:
    bucket_name: "system-config-backup"
    aws_profile: "admin"
    aws_region: "us-east-1"
    s3_path_structure: "config-backup/{year}/{month}/{day}"
  
  sync_options:
    - "--exclude=*.cache"  # Excluir archivos de caché
    - "--exclude=temp/*"   # Excluir carpeta temporal

# Logs con retención extendida
- name: "App Logs Mensual"
  description: "Logs de aplicación últimos 30 días"
  enabled: false
  local_base_path: "C:\\Apps\\Logs"
  
  sync_strategy:
    type: "DateRange"
    date_range_days_back: 30  # Últimos 30 días
  
  destination_config:
    bucket_name: "app-logs-backup"
    aws_profile: "default"
    aws_region: "us-east-1"
    s3_path_structure: "app-logs/{year}/{month}"
  
  sync_options:
    - "--exclude=*.debug"      # Excluir logs de debug
    - "--storage-class=GLACIER"  # Almacenamiento de archivo económico

# Datos científicos con estructura compleja
- name: "Datos Científicos"
  description: "Datos organizados por proyecto y fecha"
  enabled: false
  local_base_path: "D:\\Investigacion"
  
  sync_strategy:
    type: "CustomPattern"
    custom_local_pattern: "{base_path}\\Proyecto-A\\{year}\\Q{quarter}"
  
  destination_config:
    bucket_name: "research-data-backup"
    aws_profile: "research"
    aws_region: "us-west-2"
    s3_path_structure: "research/proyecto-a/{year}/quarter-{quarter}"
  
  sync_options:
    - "--exclude=*.temp"   # Excluir archivos temporales
    - "--exclude=cache/*"  # Excluir carpetas de caché

# ========================================
# GUÍA DE CONFIGURACIÓN
# ========================================
#
# ESTRATEGIAS DISPONIBLES:
#
# 1. DateFolder (Predeterminada)
#    - Sincroniza carpeta específica del día
#    - Configuración: date_folder_format (formato de fecha)
#    - Ejemplo: "yyyy-MM-dd" → 2025-01-15
#
# 2. FullDirectory
#    - Sincroniza toda la carpeta base
#    - Sin configuración adicional
#    - Útil para backups completos
#
# 3. DateRange
#    - Sincroniza archivos de un rango de fechas hacia atrás
#    - Configuración: date_range_days_back (número de días)
#    - Útil para logs y archivos con fechas variables
#
# 4. CustomPattern
#    - Sincroniza usando patrón personalizado
#    - Configuración: custom_local_pattern (patrón con placeholders)
#    - Útil para estructuras complejas
#
# PLACEHOLDERS DISPONIBLES:
# - {base_path}: Ruta base configurada en local_base_path
# - {year}: Año actual (yyyy) - Ejemplo: 2025
# - {month}: Mes actual (MM) - Ejemplo: 01
# - {day}: Día actual (dd) - Ejemplo: 15
# - {quarter}: Trimestre actual (1-4) - Ejemplo: 1
#
# CONFIGURACIÓN DE DESTINO (destination_config):
# - bucket_name: Nombre del bucket S3 (se crea automáticamente si no existe)
# - aws_profile: Perfil AWS ("default" o nombre específico)
# - aws_region: Región AWS (opcional, se detecta automáticamente)
# - s3_path_structure: Estructura de carpetas en S3 (usa placeholders)
#
# OPCIONES DE SINCRONIZACIÓN (sync_options):
# - --delete: Eliminar archivos en S3 que no existen localmente
# - --exclude=patrón: Excluir archivos que coincidan con el patrón
# - --include=patrón: Incluir solo archivos que coincidan con el patrón
# - --storage-class=clase: Clase de almacenamiento S3
#   * STANDARD: Almacenamiento estándar (por defecto)
#   * STANDARD_IA: Acceso infrecuente (más económico)
#   * GLACIER: Archivo a largo plazo (muy económico)
# - --dryrun: Simular la sincronización sin realizar cambios
#
# CREACIÓN AUTOMÁTICA DE BUCKETS:
# El sistema verifica automáticamente si los buckets S3 existen
# y los crea si es necesario con configuraciones de seguridad:
# - Versionado habilitado
# - Cifrado AES256 por defecto
# - Configuración de región apropiada
#
# COMANDOS ÚTILES:
# - Ver estrategias disponibles: .\show-sync-strategies.ps1
# - Ver ejemplos detallados: .\show-sync-strategies.ps1 -ShowExamples
# - Ejecutar sincronización: .\sync-main.ps1
# - Ver estado y estadísticas: .\show-status.ps1
# - Limpiar logs antiguos: .\clean-logs.ps1
#
# COMPATIBILIDAD:
# Este sistema mantiene compatibilidad completa con configuraciones
# anteriores que usen sync_mode y mode_config. La nueva estructura
# con sync_strategy y destination_config es la recomendada. 